<!DOCTYPE html>

<html>
	<head>
		<meta charset="UTF-8">
		
		<style>
			.list-inline a {
				color: #000000;
			}
			
			.breadcrumb a {
				color: #000000;
			}
			
			
			
			.el-header,
			.el-footer {
				background: gainsboro;
				font-size: 30px;
			}
			
			.el-menu {
				border: 0px;
			}
		</style>
	</head>
	<body>
	<div id="personApp" v-loading="loading">
			
			<el-row>
				<div>
				
				 
				</div>
				
				<el-row>
					<el-col :span="12"><div class="grid-content bg-purple-light"><label style="font-size: 20px;margin-top: 5px;;">客户信息</label></div></el-col>
  					<el-col :span="12"><div class="grid-content bg-purple"><el-button type="primary" :span="12" icon="el-icon-edit" @click="showDialog2">新增客户信息</el-button></div></el-col>
  					
  					
				</el-row>
					<el-table  :default-sort="{prop: 'pdate', order: 'descending'}" :data="this.pageInfo.list" border>
						
						<el-table-column width="100" label="序号">
							<template slot-scope="temp">
								{{temp.$index+1}}
							</template>
						</el-table-column>
						<!--`kid``vid``id``kname``kphone``kaddres``kbirthday``kremark``kb1``kb2``kb3``kb4``kb5``kb6`-->
						<el-table-column width="100" prop="kname" label="姓名">
						</el-table-column>
						<el-table-column width="100" prop="kphone" label="电话号码">
						</el-table-column>
						<el-table-column width="100" prop="kaddres" label="地址">
						</el-table-column>
						<el-table-column width="100" label="用户类型">
							<template slot-scope="temp">
								{{temp.row.vid | filterVip}}
							</template>
						</el-table-column>
						<el-table-column width="100" label="性别">
							<template slot-scope="temp">
								{{temp.row.ksex | filterSex}}
							</template>
						</el-table-column>
						
						<el-table-column width="150" prop="kbirthday" label="生日" sortable>
						</el-table-column>
						<el-table-column label="操作">
							<template slot-scope="temp">
								<el-button icon="el-icon-edit" size="mini" type="info" @click="showDialog(temp.row.kid)">查看详情</el-button>
								<!--<el-button icon="el-icon-edit" size="mini" type="primary" @click="showInfo(temp.row.pid)">查看明细</el-button>-->
								<el-button icon="el-icon-delete" size="mini" type="danger" @click="delInfo(temp.row.kid)">移除</el-button>
							</template>
						</el-table-column>
						<!--<el-table-column width="150" prop="gyl" label="權限" sortable>
						</el-table-column>
						<el-table-column label="操作">
							<template slot-scope="temp">
								
								<el-button icon="el-icon-delete" size="mini" type="danger" @click="xuezje(temp.row.pname)">选择</el-button>
								
							</template>
						</el-table-column>-->
					</el-table>
				</el-col>
			</el-row>
			<el-row >
				<el-col :span="24" >
					<el-pagination v-if="pageInfo.total!=0" :background="true"  @size-change="handleSizeChange" @current-change="handleCurrentChange" :current-page="pageInfo.pageNum" :page-size="pageInfo.pageSize" :total="pageInfo.total" :page-sizes="[3,6]"  layout="total, sizes, prev, pager, next, jumper">
					</el-pagination>
				</el-col>
			</el-row>
			<!--模态框-->
			<el-dialog :destroy-on-close="true" @opened="handlOpen" title="客户信息" :visible.sync="isShow" :before-close="handleClose" center>
				<div id="modalcnt"></div>
			</el-dialog>
			
			<!--模态框-->
			<el-dialog :destroy-on-close="true" @opened="handlOpen2" title="客户信息录入" :visible.sync="isShow2" :before-close="handleClose" center>
				<div id="modalcnt2"></div>
			</el-dialog>
		</div>
	</body>
	
	<script>
		var personApp = new Vue({
			el: '#personApp',
			data: {
				pageInfo: {},
				loading: true,
				isShow:false,
				isShow2:false
			},
			methods: {
				xuezje(name){
					window.sessionStorage.setItem("name", name);
		            done(); 
				},
				handlOpen2(){
					$("#modalcnt2").load('kehuxinxiadd.html');
				},
				handlOpen(){
					$("#modalcnt").load('kehuxianqing.html');
				},
				handleClose(done){
					this.$confirm('是否关闭').then(() => {
						done(); 
					}).catch(() => {});
				}
				,
				showDialog(pid) {
					this.isShow=true;
					sessionStorage.setItem('pid', pid);
				}
				,
				showDialog2() {
					this.isShow2=true;
				},
				showInfo(pid) {
					//indexApp.showView('kehuxinxizhuye.html);
					sessionStorage.setItem('pid', pid);
				},
				delInfo(pid) {
					let _this = this;
					this.$confirm('是否移除会员信息?', '系统提示', {
						confirmButtonText: '确定',
						cancelButtonText: '取消',
						type: 'warning'
					}).then(() => {
						$.ajax(`http://localhost:8080/api/khb/person/${pid}`, {
							type: 'delete',
							dataType: 'json',
							success(msg) {
								if(msg.code == "200") {
									_this.$message({
										type: 'success',
										message: '删除成功!'
									});
									_this.loading = true;
									_this.goToPage(1, _this.pageInfo.pageSize);
								}
							}
						});

					}).catch(() => {
						this.$message({
							type: 'info',
							message: '已取消删除'
						});
					});
				},
				handleSizeChange(val) {
					this.goToPage(this.pageInfo.pageNum, val);
				},
				handleCurrentChange(val) {
					this.goToPage(val, this.pageInfo.pageSize);
				},
				goToPage(p, s) {
					let _this = this;
					this.loading = true;
					//ajax
					$.getJSON(`http://localhost:8080/api/khb/${p}/${s}`, function(pg) {
						_this.pageInfo = pg;
						_this.loading = false;
					});
				}
			},
			mounted() {
				this.goToPage(1, 3);
			},
			filters: {
				filterSex(val) {
					return val == 0 ? '男' : '女';
				},
				filterVip(val) {
					return val == 1 ? '普通用户' : 'VIP会员';
				}
			}
		});
	</script>
